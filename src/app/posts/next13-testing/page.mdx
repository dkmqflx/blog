import Meta from "@/components/Meta";

export const metadata = {
  title: "Next.js 13ì—ì„œ Jestì™€ React Testing Libraryë¡œ í…ŒìŠ¤íŠ¸ í™˜ê²½ ì„¤ì •í•˜ê¸°",
  description:
    "Next.js 13ì—ì„œëŠ” í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ ì„¤ì •í•  ë•Œ ë‹¤ì–‘í•œ ë°©ë²•ì„ ì œê³µí•˜ì§€ë§Œ, Jestì™€ React Testing Libraryë¥¼ í™œìš©í•œ ì„¤ì •ì´ ê°€ì¥ ì¼ë°˜ì ì´ë‹¤. Next.js ê³µì‹ ë¬¸ì„œì—ì„œë„ ì—¬ëŸ¬ í…ŒìŠ¤íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ëŒ€í•œ ê°€ì´ë“œë¥¼ ì œê³µí•˜ê³  ìˆì§€ë§Œ, ì—¬ê¸°ì„œëŠ” Jestì™€ React Testing Libraryë¥¼ ê¸°ë°˜ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ êµ¬ì„±í•˜ëŠ” ë°©ë²•ì„ ì •ë¦¬í•œë‹¤.",
  date: "2023.12.23",
  route: "next13-testing",
};

<Meta metadata={metadata} />

## ê°œìš”

Next.js 13ì—ì„œëŠ” í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ ì„¤ì •í•  ë•Œ ë‹¤ì–‘í•œ ë°©ë²•ì„ ì œê³µí•˜ì§€ë§Œ, **Jest**ì™€ **React Testing Library**ë¥¼ í™œìš©í•œ ì„¤ì •ì´ ê°€ì¥ ì¼ë°˜ì ì´ë‹¤.

Next.js ê³µì‹ ë¬¸ì„œì—ì„œë„ ì—¬ëŸ¬ í…ŒìŠ¤íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ëŒ€í•œ ê°€ì´ë“œë¥¼ ì œê³µí•˜ê³  ìˆì§€ë§Œ, ì—¬ê¸°ì„œëŠ” **Jestì™€ React Testing Libraryë¥¼ ê¸°ë°˜ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ êµ¬ì„±í•˜ëŠ” ë°©ë²•**ì„ ì •ë¦¬í•œë‹¤.

> **ì°¸ê³ :** Next.js 13ì—ì„œëŠ” SWCë¥¼ ê¸°ë³¸ ì»´íŒŒì¼ëŸ¬ë¡œ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— Babel ê¸°ë°˜ì˜ ì´ì „ ë²„ì „ê³¼ ë‹¤ë¥´ê²Œ ì´ˆê¸° ì„¤ì •ì´ í•„ìš”í•  ìˆ˜ ìˆë‹¤. Babelì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ë¼ë©´ [ê³µì‹ ë¬¸ì„œì˜ Babel ì„¤ì •](https://nextjs.org/docs/pages/building-your-application/testing/jest) í•­ëª©ì„ ì°¸ê³ í•˜ë©´ ëœë‹¤.

---

## ğŸ”¹ í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜

í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ êµ¬ì¶•í•˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•´ì•¼ í•œë‹¤.

```bash
npm install -D  jest
                jest-environment-jsdom
                @testing-library/react
                @testing-library/jest-dom
                @testing-library/user-event
                @types/jest
                react-test-renderer # ìŠ¤ëƒ…ìƒ· í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬
```

### ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ëª…

- **jest**: í…ŒìŠ¤íŠ¸ ëŸ¬ë„ˆë¡œ, í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ëŠ” ì—­í• ì„ í•œë‹¤.
- **jest-environment-jsdom**: ë¸Œë¼ìš°ì € í™˜ê²½ì„ ì‹œë®¬ë ˆì´ì…˜í•  ìˆ˜ ìˆëŠ” JSDOMì„ ì œê³µí•œë‹¤.
- **@testing-library/react**: React ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸ì— í•„ìš”í•œ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.
- **@testing-library/jest-dom**: DOM ê´€ë ¨ Matcher(`toBeInTheDocument` ë“±)ë¥¼ ì¶”ê°€í•œë‹¤.
- **@testing-library/user-event**: ì‚¬ìš©ìì˜ ì´ë²¤íŠ¸(í´ë¦­, ì…ë ¥ ë“±)ë¥¼ ì‹œë®¬ë ˆì´ì…˜í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤€ë‹¤.
- **@types/jest**: TypeScript í™˜ê²½ì—ì„œ Jestë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ íƒ€ì…ì„ ì œê³µí•œë‹¤.
- **react-test-renderer**: React ì»´í¬ë„ŒíŠ¸ì˜ **ìŠ¤ëƒ…ìƒ· í…ŒìŠ¤íŠ¸**ë¥¼ ì§€ì›í•œë‹¤.

---

## ğŸ”¹ Jest ì„¤ì • íŒŒì¼ êµ¬ì„±

Jestë¥¼ Next.jsì™€ í•¨ê»˜ ì‚¬ìš©í•˜ë ¤ë©´ `jest.config.js` íŒŒì¼ì„ ìƒì„±í•˜ê³  ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•˜ë©´ ëœë‹¤.

```javascript
const nextJest = require("next/jest");

const createJestConfig = nextJest({
  dir: "./",
});

const customJestConfig = {
  setupFilesAfterEnv: ["<rootDir>/jest.setup.js"],
  testEnvironment: "jest-environment-jsdom",
  moduleNameMapper: {
    "^@/(.*)$": "<rootDir>/src/$1",
  },
};

module.exports = createJestConfig(customJestConfig);
```

ì´ ì„¤ì •ì„ í†µí•´ Next.jsì˜ ì„¤ì •ì„ Jestì— ë§ê²Œ ìµœì í™”í•  ìˆ˜ ìˆë‹¤.

---

## ğŸ”¹ Jest í™˜ê²½ ì„¤ì • íŒŒì¼ ì‘ì„±

Jest í™˜ê²½ì„ ì„¤ì •í•˜ë ¤ë©´ `jest.setup.js` íŒŒì¼ì„ ìƒì„±í•˜ê³  ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•˜ë©´ ëœë‹¤.

```javascript
import "@testing-library/jest-dom";
```

ì´ë ‡ê²Œ í•˜ë©´ **`@testing-library/jest-dom`ì˜ í™•ì¥ëœ Matcherë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë˜ì–´, í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ë” ì§ê´€ì ìœ¼ë¡œ ì‘ì„±ëœë‹¤.**

---

## ğŸ”¹ TypeScript ì„¤ì • ì—…ë°ì´íŠ¸

TypeScript í™˜ê²½ì—ì„œ Jestë¥¼ ì›í™œí•˜ê²Œ ì‚¬ìš©í•˜ë ¤ë©´ `tsconfig.json` íŒŒì¼ì— ë‹¤ìŒ ì„¤ì •ì„ ì¶”ê°€í•´ì•¼ í•œë‹¤.

```json
{
  "compilerOptions": {
    "types": ["jest", "@testing-library/jest-dom"],
    "moduleResolution": "bundler",
    "paths": {
      "@/*": ["./src/*"]
    }
  }
}
```

ì´ ì„¤ì •ì„ ì¶”ê°€í•˜ë©´ Jestì™€ ê´€ë ¨ëœ íƒ€ì…ì„ ì¸ì‹í•  ìˆ˜ ìˆìœ¼ë©°, **ì ˆëŒ€ ê²½ë¡œ(`@/components/...`)ë¥¼ ì‚¬ìš©í•œ importë„ ê°€ëŠ¥í•´ì§„ë‹¤.**

---

## ğŸ”¹ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€

í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•´ `package.json`ì— ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì¶”ê°€í•œë‹¤.

```json
"scripts": {
  "test": "jest --watch",
  "test:coverage": "jest --watch --coverage"
}
```

ì´ì œ `npm run test`ë¥¼ ì‹¤í–‰í•˜ë©´ í…ŒìŠ¤íŠ¸ê°€ ìë™ìœ¼ë¡œ ê°ì§€ë˜ê³  ì‹¤í–‰ëœë‹¤.

ì´ ë•Œ ê¸°ì¡´ì— ì‚¬ìš©í•˜ë˜ í™˜ê²½ë³€ìˆ˜ë¥¼ í…ŒìŠ¤íŒ… í™˜ê²½ì—ì„œë„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” .env.test ë¼ëŠ” ì´ë¦„ì˜ env íŒŒì¼ì„ ì¶”ê°€í•´ì£¼ì–´ì•¼ í•œë‹¤.

---

## ğŸ”¹ next-router-mock ì‚¬ìš©í•˜ê¸° (ë¼ìš°í„° ëª¨í‚¹)

í…ŒìŠ¤íŠ¸ í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ê°€ useRouterë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì— nextrouter was not mounted ë¼ëŠ” ì—ëŸ¬ ë©”ì„¸ì§€ê°€ ë‚˜íƒ€ë‚œë‹¤

ì´ëŸ¬í•œ ì—ëŸ¬ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” router ê´€ë ¨ëœ ë¶€ë¶„ì„ mocking í•´ì£¼ì–´ì•¼ í•œë‹¤.

ê³µì‹ë¬¸ì„œì˜ **[NextRouter was not mounted](https://nextjs.org/docs/messages/next-router-not-mounted)** í•­ëª©ì„ ë³´ë©´ [next-router-mock](https://www.npmjs.com/package/next-router-mock)ë¥¼ Useful Linksë¡œ ê±¸ì–´ë†“ì•˜ê¸° ë•Œë¬¸ì— í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•´ì„œ mocking í•´ì£¼ì—ˆë‹¤.

```bash
npm install -D next-router-mock
```

ê·¸ëŸ° ë‹¤ìŒ, `jest.setup.js`ì— ì•„ë˜ ë‚´ìš©ì„ ì¶”ê°€í•œë‹¤.

```javascript
jest.mock("next/router", () => require("next-router-mock"));
```

ì´ì œ `useRouter()` í›…ì„ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ë„ ì—ëŸ¬ ì—†ì´ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë‹¤.

---

## ğŸ”¹ Jest Styled Componentsì™€ ìŠ¤ëƒ…ìƒ· í…ŒìŠ¤íŠ¸ ì ìš©

Styled Componentsë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤ë©´, [Jest Styled Components](https://github.com/styled-components/jest-styled-components#jest-styled-components)ë¥¼ ì„¤ì¹˜í•˜ì—¬ **ìŠ¤ëƒ…ìƒ· í…ŒìŠ¤íŠ¸ì—ì„œ ìŠ¤íƒ€ì¼ì„ í¬í•¨í•˜ì—¬ ë¹„êµí•  ìˆ˜ ìˆë„ë¡ ì„¤ì •**í•  ìˆ˜ ìˆë‹¤.

```bash
npm install -D jest-styled-components
```

ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ í›„ ê°ê°ì˜ í…ŒìŠ¤íŠ¸ê°€ ì‹¤í–‰ë˜ê¸° ì „ì— configurationì´ ì ìš©ë˜ë„ë¡ `setupFilesAfterEnv`ì— ì¶”ê°€í•œë‹¤.

```js
// jest.config.js

setupFilesAfterEnv: ['<rootDir>/jest.setup.ts', 'jest-styled-components'],
```

---

## ğŸ”¹ Provider ì„¤ì •í•˜ê¸° (React Query, Theme Provider)

í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ ê³µí†µì ìœ¼ë¡œ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” **Provider**ê°€ ìˆë‹¤ë©´, ì´ë¥¼ ë¯¸ë¦¬ ì •ì˜í•´ ë‘ë©´ í¸ë¦¬í•˜ë‹¤.

ëŒ€í‘œì ìœ¼ë¡œ ìŠ¤íƒ€ì¼ë§ì„ ìœ„í•œ styled componentì˜ Theme Provider, ê·¸ë¦¬ê³  ì„œë²„ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ”ë° ì‚¬ìš©í•˜ëŠ” React Queryì˜ QueryClientProviderê°€ ìˆë‹¤

í…ŒìŠ¤íŠ¸ ì½”ë“œì— ìŠ¤íƒ€ì¼ ë˜ëŠ” ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìœ„í•œ ì½”ë“œê°€ ìˆë‹¤ë©´ ìœ„ì˜ Providerë¡œ ê°ì‹¸ì£¼ì–´ì•¼ í•œë‹¤.

ì´ ë•Œ ë°˜ë³µë˜ëŠ” ì½”ë“œ ì‘ì„±ì„ ì¤„ì´ê³  í•„ìš”í•œ í…ŒìŠ¤íŠ¸ì—ì„œ ì‰½ê²Œ ê°€ì ¸ë‹¤ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ Providerë¥¼ ë¯¸ë¦¬ ì •ì˜í•œë‹¤.

### **Theme Provider ì ìš©**

```javascript
import { ThemeProvider } from "styled-components";
import theme from "@/styles/theme";

export const TestThemeProvider = ({ children }) => (
  <ThemeProvider theme={theme}>{children}</ThemeProvider>
);
```

### **React Query Provider ì ìš©**

```javascript
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";

const testQueryClient = new QueryClient({
  defaultOptions: { queries: { retry: false } },
});

export const TestQueryClientProvider = ({ children }) => (
  <QueryClientProvider client={testQueryClient}>{children}</QueryClientProvider>
);
```

ì•„ë˜ ì½”ë“œëŠ” ìœ„ì—ì„œ ì •ì˜í•œ Theme Providerë¥¼ ì ìš©í•´ì„œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•œ ì˜ˆì‹œë‹¤.

```ts
import { render } from "@testing-library/react";
import { TestThemeProvider } from "@common/__test__/providers";
import Add from "./index";

describe("List", () => {
  it("img íƒœê·¸ í™•ì¸", () => {
    render(
      <TestThemeProvider>
        <img src="./images/title.png" alt="title" />
      </TestThemeProvider>
    );
    const img = screen.getByRole("img");
    expect(img).toBeInTheDocument();
  });
});
```

ì´ë ‡ê²Œ ì„¤ì •í•˜ë©´, **í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ ê³µí†µì ìœ¼ë¡œ í•„ìš”í•œ Providerë¥¼ ë§¤ë²ˆ ì„ ì–¸í•  í•„ìš” ì—†ì´ ê°„í¸í•˜ê²Œ ì ìš©í•  ìˆ˜ ìˆë‹¤.**

---

## ë§ˆì¹˜ë©°

Jestì™€ React Testing Libraryë¥¼ í™œìš©í•˜ì—¬ Next.js 13ì—ì„œ **íš¨ìœ¨ì ì¸ í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ êµ¬ì¶•í•˜ëŠ” ë°©ë²•**ì„ ì •ë¦¬í•´ ë³´ì•˜ë‹¤.

í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ êµ¬ì„±í•˜ëŠ” ê³¼ì •ì´ ì‰½ì§€ë§Œì€ ì•Šì§€ë§Œ, **í•œ ë²ˆ ì„¤ì •í•´ ë‘ë©´ ì´í›„ ê°œë°œ ìƒì‚°ì„±ì´ í¬ê²Œ í–¥ìƒëœë‹¤.**

í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ ë¯¸ë¦¬ ì„¤ì •í•´ ë‘ë©´ **ì‹¤ì œ ë°°í¬ ì „ì— ë²„ê·¸ë¥¼ ì‚¬ì „ì— ê°ì§€í•  ìˆ˜ ìˆì–´ ë” ì•ˆì •ì ì¸ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•  ìˆ˜ ìˆë‹¤.**
